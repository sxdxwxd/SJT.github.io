<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>送水记录</title>
    <link
      href="https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/5.3.0/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <style>
      .bg-light {
        background-color: #f8f9fa !important;
      }
      .navbar {
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      }
      .container {
        max-width: 1200px;
      }
      .chart-container {
        height: 400px;
        margin-bottom: 30px;
        background-color: white;
        border-radius: 8px;
        padding: 15px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.05);
      }
      .table {
        background-color: white;
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 2px 10px rgba(0,0,0,0.05);
      }
      .table th {
        background-color: #f1f3f5;
      }
    </style>
  </head>
  <body class="bg-light">
    <!-- 共用导航栏 -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
      <div class="container">
        <a class="navbar-brand" href="#">送水服务</a>
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav">
            <li class="nav-item">
              <a class="nav-link" href="water.html">水费记录</a>
            </li>
            <li class="nav-item">
              <a class="nav-link active" href="record.html">送水记录</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="markdown_list.html">文档目录</a>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <div class="container my-5">
      <div class="d-flex justify-content-between mb-4 align-items-center">
        <h2>送水记录与耗水量统计</h2>
      </div>

      <!-- ECharts图表容器 -->
      <div id="waterChart" class="chart-container"></div>

      <table class="table table-hover table-striped">
        <thead>
          <tr>
            <th>空桶</th>
            <th>新送</th>
            <th>教室总计</th>
            <th>待送</th>
            <th>日期</th>
          </tr>
        </thead>
        <tbody id="dataBody">
          <!-- 数据行通过JS动态生成 -->
        </tbody>
      </table>
      <div class="d-flex justify-content-between align-items-center mt-3">
        <button class="btn btn-outline-primary" onclick="prevPage()">
          上一页
        </button>
        <span id="pageInfo" class="text-muted"></span>
        <button class="btn btn-outline-primary" onclick="nextPage()">
          下一页
        </button>
      </div>
    </div>

    <script src="https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    <script>
      // 静态数据
      const records = [
        { emptyBuckets: "-", newDelivery: "-", classTotal: "6", pendingDelivery: "14", date: "7.18" },
        { emptyBuckets: "2", newDelivery: "5", classTotal: "9", pendingDelivery: "9", date: "7.21" },
        { emptyBuckets: "5", newDelivery: "5", classTotal: "9", pendingDelivery: "4", date: "7.22" },
        { emptyBuckets: "3", newDelivery: "0", classTotal: "6", pendingDelivery: "4", date: "7.23" },
        { emptyBuckets: "3", newDelivery: "4", classTotal: "7", pendingDelivery: "14", date: "7.24" },
        { emptyBuckets: "5", newDelivery: "5", classTotal: "7", pendingDelivery: "9", date: "7.28" },
        { emptyBuckets: "4", newDelivery: "5", classTotal: "8", pendingDelivery: "4", date: "7.29" },
        { emptyBuckets: "3", newDelivery: "0", classTotal: "5", pendingDelivery: "4", date: "7.30" },
        { emptyBuckets: "3", newDelivery: "5", classTotal: "7", pendingDelivery: "-1", date: "7.31" },
        { emptyBuckets: "5", newDelivery: "5", classTotal: "7", pendingDelivery: "8", date: "8.3" },
        { emptyBuckets: "4", newDelivery: "5", classTotal: "8", pendingDelivery: "3", date: "8.4" },
        { emptyBuckets: "3", newDelivery: "0", classTotal: "5", pendingDelivery: "3", date: "8.5" },
        { emptyBuckets: "3", newDelivery: "5", classTotal: "8", pendingDelivery: "-2", date: "8.6" },
        { emptyBuckets: "3", newDelivery: "0", classTotal: "5", pendingDelivery: "12", date: "8.7" },
        { emptyBuckets: "2", newDelivery: "5", classTotal: "8", pendingDelivery: "7", date: "8.11" },
      ];

      // 初始化页面
      function init() {
        renderTable();
        initChart();
      }

      // 表格分页渲染
      let currentPage = 1;
      const pageSize = 5;

      function renderTable() {
        const start = (currentPage - 1) * pageSize;
        const end = start + pageSize;
        const tbody = document.getElementById("dataBody");
        tbody.innerHTML = records
          .slice(start, end)
          .map(
            (record) => `
          <tr>
            <td>${record.emptyBuckets}</td>
            <td>${record.newDelivery}</td>
            <td>${record.classTotal}</td>
            <td>${record.pendingDelivery}</td>
            <td>${record.date}</td>
          </tr>`
          )
          .join("");

        document.getElementById(
          "pageInfo"
        ).textContent = `第${currentPage}页，共${Math.ceil(
          records.length / pageSize
        )}页`;
      }

      function prevPage() {
        if (currentPage > 1) {
          currentPage--;
          renderTable();
        }
      }

      function nextPage() {
        if (currentPage < Math.ceil(records.length / pageSize)) {
          currentPage++;
          renderTable();
        }
      }

      // 初始化ECharts图表
      function initChart() {
        const chartDom = document.getElementById('waterChart');
        const myChart = echarts.init(chartDom);
        
        // 提取图表数据
        const dates = records.map(item => item.date);
        const classTotals = records.map(item => parseInt(item.classTotal));
        
        const option = {
          title: {
            text: '教室耗水量趋势',
            left: 'center'
          },
          tooltip: {
            trigger: 'axis'
          },
          legend: {
            data: ['教室总计'],
            bottom: 0
          },
          grid: {
            left: '3%',
            right: '4%',
            bottom: '15%',
            containLabel: true
          },
          xAxis: {
            type: 'category',
            data: dates,
            axisLabel: {
              rotate: 30,
              interval: 0
            }
          },
          yAxis: {
            type: 'value',
            name: '数量'
          },
          series: [
            {
              name: '教室总计',
              type: 'line',
              data: classTotals,
              smooth: true,
              markPoint: {
                data: [
                  { type: 'max', name: '最大值' },
                  { type: 'min', name: '最小值' }
                ]
              },
              markLine: {
                data: [
                  { type: 'average', name: '平均值' }
                ]
              }
            }
          ],
          media: [
            {
              query: {
                maxWidth: 500
              },
              option: {
                grid: {
                  bottom: '20%'
                },
                xAxis: {
                  axisLabel: {
                    rotate: 45,
                    fontSize: 10
                  }
                }
              }
            }
          ]
        };

        myChart.setOption(option);
        
        // 响应窗口大小变化
        window.addEventListener('resize', function() {
          myChart.resize();
        });
      }

      init();
    </script>
  </body>
</html>
